# Entity Relationship Diagram (ERD)

```mermaid
erDiagram
    User ||--o{ JobPost : "creates"
    User ||--o{ GeneratedJobPost : "generates"
    User ||--o{ Resume : "uploads"
    User ||--o{ meetings : "creates"
    User ||--o{ Interview : "conducts/owns"
    User ||--o{ InterviewAttempt : "interviews (as interviewer)"
    User ||--o{ CandidateInteraction : "manages"
    User ||--o{ AssessmentStage : "conducts"
    User ||--o{ MCQTemplate : "creates"
    User ||--o{ OfferLetter : "creates"
    User }|--|| companies : "belongs to"

    companies ||--o{ JobPost : "has"
    companies ||--o{ User : "has"
    companies ||--o{ MCQTemplate : "owns"

    JobPost ||--o{ GeneratedJobPost : "has versions"
    JobPost ||--o{ Resume : "receives"
    JobPost ||--o{ meetings : "has"
    JobPost ||--o{ Interview : "has"
    JobPost ||--o{ CandidateInteraction : "tracks"
    JobPost ||--o{ AssessmentStage : "has stages"
    JobPost ||--o{ OfferLetter : "has offers"
    JobPost }|--|| companies : "belongs to"
    JobPost }|--|| User : "created by"

    Resume ||--o{ meetings : "associated with"
    Resume ||--o{ Interview : "associated with"
    Resume ||--o{ CandidateInteraction : "tracks"
    Resume ||--o{ AssessmentStage : "undergoes"
    Resume ||--o{ OfferLetter : "receives"
    Resume }|--|| JobPost : "applies to"
    Resume }|--o| User : "uploaded by"

    meetings }|--|| User : "created by"
    meetings }|--|| JobPost : "linked to"
    meetings }|--|| Resume : "with candidate"
    meetings |o--o| CandidateInteraction : "linked to"

    Interview ||--o{ Question : "contains"
    Interview ||--o{ InterviewAttempt : "has attempts"
    Interview }|--|| JobPost : "linked to"
    Interview }|--|| Resume : "for candidate"
    Interview }|--|| User : "owned by"
    Interview |o--o| CandidateInteraction : "linked to"

    InterviewAttempt }|--|| Interview : "attempt of"
    InterviewAttempt }|--|| User : "conducted by"
    InterviewAttempt ||--o{ Answer : "contains"
    InterviewAttempt ||--o{ ActivityLog : "logs"
    InterviewAttempt ||--o{ Recording : "has"

    Question ||--o{ Answer : "answered in"
    Question }|--|| Interview : "part of"

    Answer }|--|| InterviewAttempt : "part of"
    Answer }|--|| Question : "answers"

    AssessmentStage }|--|| JobPost : "for"
    AssessmentStage }|--|| Resume : "for"
    AssessmentStage }|--o| User : "interviewer"
    AssessmentStage |o--o| MCQAssessment : "is type"
    AssessmentStage |o--o| AvatarAssessment : "is type"
    AssessmentStage |o--o| ManualMeeting : "is type"

    MCQAssessment ||--o{ MCQQuestion : "contains"
    MCQAssessment ||--o{ MCQAnswer : "has answers"
    MCQAssessment }|--|| AssessmentStage : "linked to"

    MCQQuestion }|--|| MCQAssessment : "part of"
    MCQQuestion ||--o{ MCQAnswer : "answered in"

    MCQAnswer }|--|| MCQAssessment : "part of"
    MCQAnswer }|--|| MCQQuestion : "answers"

    AvatarAssessment }|--|| AssessmentStage : "linked to"
    AvatarAssessment ||--o{ AvatarRecording : "has recordings"

    AvatarRecording }|--|| AvatarAssessment : "part of"

    ManualMeeting }|--|| AssessmentStage : "linked to"

    MCQTemplate }|--|| companies : "owned by"
    MCQTemplate }|--|| User : "created by"

    OfferLetter }|--|| JobPost : "for"
    OfferLetter }|--|| Resume : "for"
    OfferLetter }|--|| User : "created by"

    GeneratedJobPost }|--|| User : "generated by"
    GeneratedJobPost }|--|| JobPost : "version of"
```

## Detailed Schema Description

### Core Entities
- **User**: System users (Admin, Manager, Company User). Links to Company.
- **companies**: Organization entity. Contains Users and Job Posts.
- **JobPost**: The central entity for hiring. Specific to a Company and User.
- **Resume**: Candidate profiles linked to a specific Job Post.

### Interactions & Workflow
- **CandidateInteraction**: A legacy unified table tracking interactions (Meetings, AI Interviews, Exams).
- **AssessmentStage**: The **new** unified assessment system. It tracks the stage of a candidate (MCQ, Avatar, Manual) for a specific Job/Resume.
    - **MCQAssessment**: Specific details for MCQ stages.
    - **AvatarAssessment**: Specific details for AI Avatar interview stages.
    - **ManualMeeting**: Specific details for human-led meetings.

### Interview & Testing
- **Interview**: Defines an interview session (questions, duration).
- **Question**: Questions within an interview.
- **InterviewAttempt**: An instance of a candidate taking an interview.
    - **Answer**: Responses to questions.
    - **ActivityLog**: Anti-cheat and system logs (tab switch, etc.).
    - **Recording**: Video/Audio recordings of attempts.

### MCQ System (Detailed)
- **MCQTemplate**: A bank of reusable questions owned by a company/user.
- **MCQQuestion**: Questions specific to an assessment instance.
- **MCQAnswer**: Candidate answers for MCQ assessments.

### Offer Management
- **OfferLetter**: Manages the final stage of hiring - generating and tracking job offers.

### System & Logging
- **ApiLog**: Logs of API function calls.
- **SystemConfig**: Dynamic system configuration.
- **AuditLog**: Security and action auditing.
